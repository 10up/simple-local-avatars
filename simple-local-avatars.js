!function(){var e,t,a,i,o,r,l,n,s,c=!1;function d(e){void 0==t&&(a=document.getElementById("simple-local-avatar-ratings"),t=jQuery(document.getElementById("simple-local-avatar-spinner")),i=document.getElementById("simple-local-avatar-photo"),o=jQuery(a).closest("form").find("input[type=submit]")),"unlock"==e?(c=!1,o.removeAttr("disabled"),t.hide()):(c=!0,o.attr("disabled","disabled"),t.show())}function p(e,t){var a=t.get("control"),i=e.get("width"),o=e.get("height"),r=parseInt(a.params.width,10),l=parseInt(a.params.height,10),n=r/l;t.set("canSkipCrop",!a.mustBeCropped(!1,!1,r,l,i,o));var s=r,c=l;i/o>n?r=(l=o)*n:l=(r=i)/n;var d=(i-r)/2,p=(o-l)/2;return{handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:i,imageHeight:o,minWidth:s>r?r:s,minHeight:c>l?l:c,x1:d,y1:p,x2:r+d,y2:l+p,aspectRatio:"".concat(r,":").concat(l)}}function m(e,t,o,r){var l={};l.url=e,l.thumbnail_url=e,l.timestamp=_.now(),t&&(l.attachment_id=t),o&&(l.width=o),r&&(l.height=r),d("lock"),jQuery.post(ajaxurl,{action:"assign_simple_local_avatar_media",media_id:t,user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.mediaNonce}).done((function(e){""!=e&&(i.innerHTML=e,jQuery("#simple-local-avatar-remove").show(),a.disabled=!1)})).always((function(){d("unlock")}))}jQuery(document).ready((function(t){l=t("#simple-local-avatar"),r=t("#simple-local-avatar-photo img"),s=r.attr("src"),a=t("#simple-local-avatar-ratings"),i=t("#simple-local-avatar-photo"),t("#simple-local-avatar-media").on("click",(function(t){if(t.preventDefault(),!c){var o={id:"control-id",params:{flex_width:!1,flex_height:!1,width:200,height:200},mustBeCropped:function(e,t,a,i,o,r){return o!==a||r!==distH}};(e=wp.media({button:{text:i10n_SimpleLocalAvatars.selectCrop,close:!1},states:[new wp.media.controller.Library({title:i10n_SimpleLocalAvatars.selectCrop,library:wp.media.query({type:"image"}),multiple:!1,date:!1,priority:20,suggestedWidth:200,suggestedHeight:200}),new wp.media.controller.CustomizeImageCropper({imgSelectOptions:p,control:o})]})).on("cropped",(function(e){m(e.url,e.id,e.width,e.height)})),e.on("skippedcrop",(function(e){var t=e.get("url"),a=e.get("width"),i=e.get("height");m(t,e.id,a,i)})),e.on("select",(function(){var t,r=e.state().get("selection").first().toJSON();o.params.width!==r.width||o.params.height!==r.height||o.params.flex_width||o.params.flex_height?e.setState("cropper"):(r.dst_width=r.width,r.dst_height=r.height,t=r,d("lock"),jQuery.post(ajaxurl,{action:"assign_simple_local_avatar_media",media_id:t.id,user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.mediaNonce}).done((function(e){""!=e&&(i.innerHTML=e,jQuery("#simple-local-avatar-remove").show(),a.disabled=!1,d("unlock"))})).always((function(){d("unlock")})),e.close())})),e.open()}})),t("#simple-local-avatar-remove").on("click",(function(e){e.preventDefault(),c||(d("lock"),t.get(ajaxurl,{action:"remove_simple_local_avatar",user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.deleteNonce}).done((function(e){""!=e&&(i.innerHTML=e,t("#simple-local-avatar-remove").hide(),a.disabled=!0)})).always((function(){d("unlock")})))})),l.on("change",(function(e){r.attr("srcset",""),r.attr("height","auto"),URL.revokeObjectURL(n),e.target.files.length>0?(n=URL.createObjectURL(e.target.files[0]),r.attr("src",n)):r.attr("src",s)}))})),module.exports={}}();