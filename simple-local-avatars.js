var simple_local_avatar_frame,avatar_spinner,avatar_ratings,avatar_container,avatar_form_button,avatar_preview,avatar_input,avatar_blob,current_avatar,avatar_working=!1;function avatar_lock(a){null==avatar_spinner&&(avatar_ratings=document.getElementById("simple-local-avatar-ratings"),avatar_spinner=jQuery(document.getElementById("simple-local-avatar-spinner")),avatar_container=document.getElementById("simple-local-avatar-photo"),avatar_form_button=jQuery(avatar_ratings).closest("form").find("input[type=submit]")),"unlock"==a?(avatar_working=!1,avatar_form_button.removeAttr("disabled"),avatar_spinner.hide()):(avatar_working=!0,avatar_form_button.attr("disabled","disabled"),avatar_spinner.show())}jQuery(document).ready(function(a){avatar_input=a("#simple-local-avatar"),avatar_preview=a("#simple-local-avatar-photo img"),current_avatar=avatar_preview.attr("src"),a(document.getElementById("simple-local-avatar-media")).on("click",function(t){t.preventDefault(),avatar_working||(simple_local_avatar_frame?simple_local_avatar_frame.open():((simple_local_avatar_frame=wp.media.frames.simple_local_avatar_frame=wp.media({title:i10n_SimpleLocalAvatars.insertMediaTitle,button:{text:i10n_SimpleLocalAvatars.insertIntoPost},library:{type:"image"},multiple:!1})).on("select",function(){avatar_lock("lock");var t=simple_local_avatar_frame.state().get("selection").first().toJSON().id;jQuery.post(ajaxurl,{action:"assign_simple_local_avatar_media",media_id:t,user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.mediaNonce},function(t){""!=t&&(avatar_container.innerHTML=t,a(document.getElementById("simple-local-avatar-remove")).show(),avatar_ratings.disabled=!1,avatar_lock("unlock"))})}),simple_local_avatar_frame.open()))}),a(document.getElementById("simple-local-avatar-remove")).on("click",function(t){t.preventDefault(),avatar_working||(avatar_lock("lock"),a.get(ajaxurl,{action:"remove_simple_local_avatar",user_id:i10n_SimpleLocalAvatars.user_id,_wpnonce:i10n_SimpleLocalAvatars.deleteNonce}).done(function(t){""!=t&&(avatar_container.innerHTML=t,a(document.getElementById("simple-local-avatar-remove")).hide(),avatar_ratings.disabled=!0,avatar_lock("unlock"))}))}),avatar_input.on("change",function(a){avatar_preview.attr("srcset",""),avatar_preview.attr("height","auto"),URL.revokeObjectURL(avatar_blob),a.target.files.length>0?(avatar_blob=URL.createObjectURL(a.target.files[0]),avatar_preview.attr("src",avatar_blob)):avatar_preview.attr("src",current_avatar)})});